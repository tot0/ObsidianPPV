/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var z=Object.create;var v=Object.defineProperty;var J=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames,N=Object.getOwnPropertySymbols,Y=Object.getPrototypeOf,_=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var K=(s,e,t)=>e in s?v(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,U=(s,e)=>{for(var t in e||(e={}))_.call(e,t)&&K(s,t,e[t]);if(N)for(var t of N(e))Z.call(e,t)&&K(s,t,e[t]);return s};var $=s=>v(s,"__esModule",{value:!0});var ee=(s,e)=>{$(s);for(var t in e)v(s,t,{get:e[t],enumerable:!0})},te=(s,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of X(e))!_.call(s,r)&&r!=="default"&&v(s,r,{get:()=>e[r],enumerable:!(t=J(e,r))||t.enumerable});return s},R=s=>te($(v(s!=null?z(Y(s)):{},"default",s&&s.__esModule&&"default"in s?{get:()=>s.default,enumerable:!0}:{value:s,enumerable:!0})),s);var a=(s,e,t)=>new Promise((r,i)=>{var n=p=>{try{o(t.next(p))}catch(c){i(c)}},l=p=>{try{o(t.throw(p))}catch(c){i(c)}},o=p=>p.done?r(p.value):Promise.resolve(p.value).then(n,l);o((t=t.apply(s,e)).next())});ee(exports,{default:()=>D});var x=R(require("obsidian"));var j=R(require("obsidian"));var y=class{process(e){this.promise=new Promise((t,r)=>a(this,null,function*(){try{let i=yield e;i=i===null||i===""?null:i,this.title=i,this.promise=null,t(this.title)}catch(i){r(i)}}))}await(){return a(this,null,function*(){var e;return(e=this.promise)!=null?e:this.title})}isResolved(){return this.promise===null}getResolved(){return this.title}};var E=class extends Error{};var M=class{static parse(e,t){var n;if(e==="")throw new E(`Meta path is empty (got "${e}")`);let r=e.split("."),i=t;for(let l of r)if(i=(n=i==null?void 0:i[l])!=null?n:null,i===null)return null;switch(typeof i){case"number":return String(i);case"string":return i;default:throw new TypeError(`value of "${e}" path must be string or number, ${typeof i} got`)}}};var g=class extends Error{};var P=class{constructor(e){this.template=e;this.metaPaths=[];this.pattern=A;this.parse()}buildTitle(e){var r;let t=this.template;for(let i of this.metaPaths){if(e[i]===void 0)throw new g(`Template path ${i} is undefined`);t=t.replace(`{{${i}}}`,(r=e[i])!=null?r:"")}return(t==null?void 0:t.length)>0?t:null}getMetaPaths(){return this.metaPaths}parse(){let e=this.template.match(new RegExp(this.pattern,"g"));for(let t of e){let{groups:{title:r}}=t.match(this.pattern);this.metaPaths.push(r)}}};var I=class{constructor(e){this.template=e}buildTitle(e){if(e[this.template]===void 0)throw new g(`Title path ${this.template} is undefined`);let t=e[this.template];return(t==null?void 0:t.length)>0?t:null}getMetaPaths(){return[this.template]}};var A="{{(?<title>.*?)}}",b=class{static create(e){return new RegExp(A).test(e)?new P(e):new I(e)}};var h=class{constructor(e,t){this.cache=e;this.listeners=new Map;this.template=null;this.collection=new Map,this.options=U({},t),this.template=b.create(this.options.metaPath)}static getPathByAbstract(e){return e instanceof j.TAbstractFile?e.path:e}on(e,t){return this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t),this}removeAllListeners(e){this.listeners.delete(e)}setExcluded(e){let t=this.options.excluded.some(i=>!e.includes(i)),r=e.some(i=>!this.options.excluded.includes(i));if((t||r)&&(this.options.excluded=e),r)for(let i of this.collection.keys())this.isExcluded(i)&&(this.collection.delete(i),t=!0);t&&this.emit("unresolved")}setMetaPath(e){this.options.metaPath!==e&&(this.collection.clear(),this.options.metaPath=e,this.template=b.create(e),this.emit("unresolved"))}isSupported(e){return!this.isExcluded(e)&&/\.md$/.test(e)}isResolved(e){var r;let t=h.getPathByAbstract(e);return(r=this.collection.get(t))==null?void 0:r.isResolved()}getResolved(e){var r,i;let t=h.getPathByAbstract(e);return(i=(r=this.collection.get(t))==null?void 0:r.getResolved())!=null?i:null}resolve(e){return a(this,null,function*(){let t=this.getOrCreate(h.getPathByAbstract(e));return t?t.await():null})}revoke(e){this.collection.delete(h.getPathByAbstract(e))}emit(e){var t;for(let r of(t=this.listeners.get(e))!=null?t:[])r()}isExcluded(e){for(let t of this.options.excluded)if(new RegExp(`^${t}`).test(e))return!0;return!1}getOrCreate(e){if(this.isSupported(e)){if(!this.collection.has(e)){let t=new y;t.process(this.makeTitle(e)),this.collection.set(e,t)}return this.collection.get(e)}return null}makeTitle(e){return a(this,null,function*(){var n,l;let t=(l=(n=this.cache.getCache(e))==null?void 0:n.frontmatter)!=null?l:{},r=this.template.getMetaPaths(),i=Object.fromEntries(r.map(o=>[o,M.parse(o,t)]));return this.template.buildTitle(i)})}};var S=class{constructor(e,t){this.explorerView=e;this.resolver=t;this.originTitles=new Map;this.enabled=!1;this.isTitleEmpty=e=>e===null||e===""}isEnabled(){return this.enabled}disable(){this.restoreTitles(),this.enabled=!1}enable(){this.enabled=!0}update(e=null){return a(this,null,function*(){if(!this.isEnabled())return!1;let r=(e?[this.explorerView.fileItems[e.path]]:Object.values(this.explorerView.fileItems)).map(i=>this.setTitle(i));return Promise.all(r).then(()=>!0)})}setTitle(e){return a(this,null,function*(){let t=yield this.resolver.resolve(e.file).catch(()=>null);if(this.isTitleEmpty(t))return this.restore(e);e.titleInnerEl.innerText!==t&&(this.keepOrigin(e),e.titleInnerEl.innerText=t)})}keepOrigin(e){this.originTitles.has(e.file.path)||this.originTitles.set(e.file.path,e.titleInnerEl.innerText)}restoreTitles(){Object.values(this.explorerView.fileItems).map(this.restore.bind(this))}restore(e){this.originTitles.has(e.file.path)&&(e.titleInnerEl.innerText=this.originTitles.get(e.file.path),this.originTitles.delete(e.file.path))}};var k=class{constructor(e,t,r,i){this.proto=e;this.method=t;this.args=r;this.implementation=i;this.vanilla=null;this.valid()}valid(){if(typeof this.proto[this.method]!="function")throw new Error(`Method ${this.method} is not a function`)}enable(){if(this.vanilla!==null)return!1;let e=this;return this.vanilla=this.proto[this.method],this.proto[this.method]=function(...t){return e.implementation.call(this,e.args,t,e.vanilla)},!0}disable(){this.vanilla!==null&&(this.proto[this.method]=this.vanilla,this.vanilla=null)}};function W(s,e,t){var r,i,n;e===void 0&&(e=50),t===void 0&&(t={});var l=(r=t.isImmediate)!=null&&r,o=(i=t.callback)!=null&&i,p=t.maxWait,c=Date.now(),f=[];function q(){if(p!==void 0){var u=Date.now()-c;if(u+e>=p)return p-u}return e}var V=function(){var u=[].slice.call(arguments),w=this;return new Promise(function(C,B){var Q=l&&n===void 0;if(n!==void 0&&clearTimeout(n),n=setTimeout(function(){if(n=void 0,c=Date.now(),!l){var O=s.apply(w,u);o&&o(O),f.forEach(function(H){return(0,H.resolve)(O)}),f=[]}},q()),Q){var L=s.apply(w,u);return o&&o(L),C(L)}f.push({resolve:C,reject:B})})};return V.cancel=function(u){n!==void 0&&clearTimeout(n),f.forEach(function(w){return(0,w.reject)(u)}),f=[]},V}var F=class{constructor(e,t){this.items=new Set,this.cb=W(()=>a(this,null,function*(){return e(this.items)}),t)}add(e){return this.items.add(e),this.cb()}};var m=class{constructor(e,t){this.workspace=e;this.resolver=t;this.replacement=null;this.enabled=!1;this.resolved=new Map;this.queue=new F(this.runQueue.bind(this),50)}static getReplaceFunction(){return function(e,t,r){if(e.resolver.isSupported(this.id)){let i=e.resolved.get(this.id);if(i)return i;e.resolved.has(this.id)||e.queue.add(this.id).catch(console.error)}return r.call(this,...t)}}disable(){this.replacement.disable(),this.reloadIframeWithNodes(new Set(this.resolved.keys())),this.enabled=!1}enable(){if(this.replacement===null){let e=this.getFirstGraphNode();if(e){this.replacement=this.createReplacement(e),this.replacement.enable(),this.enabled=!0;return}}else this.enabled=!0}isEnabled(){return this.enabled}update(e=null){return a(this,null,function*(){var t,r,i;if(!this.enabled)return!1;for(let n of this.getLeaves())for(let l of(i=(r=(t=n.view)==null?void 0:t.renderer)==null?void 0:r.nodes)!=null?i:[])if(e&&e.path===l.id){this.queue.add(l.id).catch(console.error);break}else e===null&&this.queue.add(l.id).catch(console.error);return!0})}getFirstGraphNode(){var e,t,r,i,n;for(let l of this.workspace.getLeavesOfType("graph")){let o=(n=(i=(r=(t=(e=l==null?void 0:l.view)==null?void 0:e.renderer)==null?void 0:t.nodes)!=null?r:[])==null?void 0:i.first())!=null?n:null;if(o)return o}return null}getLeaves(){return this.workspace.getLeavesOfType("graph")}resolveTitles(e){return a(this,null,function*(){let t=[];for(let r of e)t.push(this.resolver.resolve(r).then(i=>[r,i]).catch(()=>[r,!1]));return yield Promise.all(t)})}runQueue(e){return a(this,null,function*(){let t=!1;for(let[r,i]of yield this.resolveTitles(e))t||(this.resolved.has(r)||(t=!0),this.resolved.get(r)!==i&&(t=!0)),this.resolved.set(r,i);if(t==!1){e.clear();return}this.reloadIframeWithNodes(e),e.clear()})}reloadIframeWithNodes(e){var t,r,i,n,l;for(let o of this.getLeaves()){let p=(i=(r=(t=o==null?void 0:o.view)==null?void 0:t.renderer)==null?void 0:r.nodes)!=null?i:[];for(let c of p)if(e.has(c.id)){(l=(n=o.view)==null?void 0:n.renderer)==null||l.onIframeLoad();break}}}createReplacement(e){return new k(Object.getPrototypeOf(e),"getDisplayText",this,m.getReplaceFunction())}};var d=R(require("obsidian")),T=class{constructor(e){this.settings=Object.assign({},T.getDefault(),e)}static getDefault(){return{path:"title",excluded_folders:[],graph_enabled:!0,explorer_enabled:!0}}set(e,t){this.settings[e]=t}get(e){return this.settings[e]}getAll(){return this.settings}},G=class extends d.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"Settings for plugin."}),new d.Setting(e).setName("Meta title path").setDesc('Set a yaml path, which value will be used as a file title. Value must be string or numeric. Also you can use template-like path using "{{ }}". See Readme to find out').addText(t=>t.setPlaceholder("Type path").setValue(this.plugin.settings.get("path")).onChange(r=>a(this,null,function*(){this.plugin.settings.set("path",r),yield this.plugin.saveSettings()}))),new d.Setting(e).setName("Exclude folders").setDesc("Set excluded folders and files in this folders will not be parsed").addTextArea(t=>t.setValue(this.plugin.settings.get("excluded_folders").join(`
`)).onChange(r=>a(this,null,function*(){this.plugin.settings.set("excluded_folders",r.split(`
`).filter(i=>i)),yield this.plugin.saveSettings()}))),new d.Setting(e).setName("Enable explorer titles").setDesc("If it is on, plugin will replace titles in file explorer and update them").addToggle(t=>t.setValue(this.plugin.settings.get("explorer_enabled")).onChange(r=>a(this,null,function*(){this.plugin.settings.set("explorer_enabled",r),yield this.plugin.saveSettings()}))),new d.Setting(e).setName("Enable graph titles").setDesc("If it is on, plugin will replace titles in graph and update them").addToggle(t=>t.setValue(this.plugin.settings.get("graph_enabled")).onChange(r=>a(this,null,function*(){this.plugin.settings.set("graph_enabled",r),yield this.plugin.saveSettings()})))}};var D=class extends x.Plugin{constructor(){super(...arguments);this.managers=new Map}get graph(){var e;return(e=this.managers.get("graph"))!=null?e:null}get explorer(){var e;return(e=this.managers.get("explorer"))!=null?e:null}saveSettings(){return a(this,null,function*(){let e=this.settings.getAll();yield this.saveData(e),this.resolver.setMetaPath(e.path),this.resolver.setExcluded(e.excluded_folders),this.toggleGraph(e.graph_enabled),yield this.toggleExplorer(e.explorer_enabled)})}onload(){return a(this,null,function*(){this.saveSettings=(0,x.debounce)(this.saveSettings,500,!0),this.settings=new T(yield this.loadData()),this.bind(),this.resolver=new h(this.app.metadataCache,{metaPath:this.settings.get("path"),excluded:this.settings.get("excluded_folders")}),this.resolver.on("unresolved",(0,x.debounce)(()=>this.onUnresolvedHandler(),200)),this.app.workspace.onLayoutReady(()=>{this.toggleGraph(this.settings.get("graph_enabled")),this.toggleExplorer(this.settings.get("explorer_enabled"))}),this.addSettingTab(new G(this.app,this))})}onunload(){this.managers.forEach(e=>e.disable()),this.resolver.removeAllListeners("unresolved")}getExplorerView(){var t;let e=this.app.workspace.getLeavesOfType("file-explorer");return e.length>1?(console.log("there is more then one explorer"),null):((t=e==null?void 0:e.first())==null?void 0:t.view)===void 0?(console.log("explorer is undefined"),null):e.first().view}toggleExplorer(e=!0){return a(this,null,function*(){if(e&&!this.explorer){let t=this.getExplorerView();this.managers.set("explorer",new S(t,this.resolver)),this.explorer.enable(),yield this.explorer.update()}else!e&&this.explorer&&(this.explorer.disable(),this.managers.delete("explorer"))})}toggleGraph(e=!0){e&&!this.graph?(this.managers.set("graph",new m(this.app.workspace,this.resolver)),this.graph.enable(),this.graph.update().catch(console.error)):!e&&this.graph&&(this.graph.disable(),this.managers.delete("graph"))}bind(){this.registerEvent(this.app.metadataCache.on("changed",t=>{var r;(r=this.resolver)==null||r.revoke(t),this.runManagersUpdate(t).catch(console.error)}));let e=()=>{!this.graph||this.graph.isEnabled()||(this.graph.enable(),this.graph.isEnabled()?this.graph.update().catch(console.error):this.app.workspace.getLeavesOfType("graph").length&&setTimeout(e.bind(this),20))};this.registerEvent(this.app.workspace.on("layout-change",e))}runManagersUpdate(e=null){return a(this,null,function*(){let t=[];for(let r of this.managers.values())t.push(r.update(e));yield Promise.all(t)})}onUnresolvedHandler(){return a(this,null,function*(){yield this.runManagersUpdate()})}};
