/*
THIS IS A GENERATED/BUNDLED FILE BY ROLLUP
if you want to view the source visit the plugins github repository
*/

'use strict';

var obsidian = require('obsidian');

/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */

function __awaiter(thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
}

const withSubfolderClass = 'oz-with-subfolder';
const showAllNumbersClass = 'oz-show-all-num';
const rootHiddenClass = 'oz-root-hidden';
const isFolder = (item) => item.file instanceof obsidian.TFolder;
const iterateItems = (items, callback) => {
    for (const key in items) {
        if (!Object.prototype.hasOwnProperty.call(items, key))
            continue;
        callback(items[key]);
    }
};

const setupTitle = (plugin, vault, revert = false) => {
    if (!plugin.fileExplorer)
        throw new Error('fileExplorer not found');
    iterateItems(plugin.fileExplorer.fileItems, (item) => {
        if (!isFolder(item)) {
            setTitle(item, vault);
        }
    });
};
const setTitle = (item, vault) => {
    if (item.file.extension != "md") {
        return;
    }
    let idMatch = item.file.basename.match(/([0-9]+|[a-z]+)/g);
    if (idMatch) {
        let indentCount = (idMatch.length - 1);
        let indentStr = (indentCount * 20).toString() + "px";
        item.titleEl.style.marginLeft = indentStr;
    }
    vault.read(item.file).then(function (val) {
        const match = /# (.+)\s*/.exec(val);
        if (match != null) {
            const name = match[1];
            item.titleInnerEl.innerText = name;
        }
    }).catch(error => {
        console.log(`Error retrieving content of ${item.file.path}: ${error}`);
    });
};
const updateTitle = (targetList, plugin, vault) => {
    const { fileExplorer } = plugin;
    if (!fileExplorer) {
        console.error('fileExplorer missing');
        return;
    }
    for (const path of targetList) {
        // check if path available
        if (!fileExplorer.fileItems[path])
            continue;
        setTitle(fileExplorer.fileItems[path], vault);
    }
};

class VaultHandler {
    constructor(plugin) {
        this.waitingList = [];
        this.update = obsidian.debounce(() => updateTitle(this.waitingList, this.plugin, this.vault), 500, true);
        this.handler = (...args) => {
            for (const arg of args) {
                const path = arg instanceof obsidian.TAbstractFile ? arg.path : arg;
                this.waitingList.push(path);
            }
            this.update();
        };
        this.registerVaultEvent = () => {
            this.plugin.registerEvent(this.vault.on('create', this.handler));
            this.plugin.registerEvent(this.vault.on('rename', this.handler));
            this.plugin.registerEvent(this.vault.on('delete', this.handler));
        };
        this.plugin = plugin;
    }
    get app() {
        return this.plugin.app;
    }
    get vault() {
        return this.plugin.app.vault;
    }
}

class GraphInteractor {
    constructor(plugin) {
        this.plugin = plugin;
    }
    updateGraphNodes() {
        let graph = this.getGraph();
        if (graph == undefined || graph.renderer == undefined) {
            return;
        }
        //@ts-ignore
        for (const node of graph.renderer.nodes) {
            let text = this.getDisplayText(node);
            node.getDisplayText = () => text;
            node.didSetTitle = true;
            node.initGraphics();
        }
        graph.renderer.onIframeLoad();
    }
    //@ts-ignore
    getDisplayText(node) {
        //@ts-ignore
        let cache = this.plugin.app.metadataCache.getCache(node.id);
        if (cache == undefined || cache.headings == undefined) {
            return node.id;
        }
        if (cache.headings.length == 0) {
            return node.id;
        }
        return cache.headings[0].heading;
    }
    getGraphOfType(type) {
        //@ts-ignore
        let leaves = this.plugin.app.workspace.getLeavesOfType(type); // this function takes a string instead of view object, so it's easier
        //@ts-ignore
        for (const leaf of leaves) {
            if (leaf.view.getViewType() == type) {
                console.log("found graph view");
                return leaf.view;
            }
        }
    }
    getGraph() {
        var _a;
        //@ts-ignore
        if (this.plugin.app.internalPlugins.getPluginById('graph')) { // no need to bother if the graph is disabled
            return (_a = this.getGraphOfType('graph')) !== null && _a !== void 0 ? _a : this.getGraphOfType('localgraph');
        }
    }
}

const DEFAULT_SETTINGS = {
    showAllNumbers: false,
    filterList: ['md'],
    blacklist: false,
};

class FileExplorerNoteCount extends obsidian.Plugin {
    constructor() {
        super(...arguments);
        this.settings = DEFAULT_SETTINGS;
        this.vaultHandler = new VaultHandler(this);
        this.graphInteractor = new GraphInteractor(this);
        /** compatible with theme that hide root folder */
        this.doHiddenRoot = (revert = false) => {
            if (!this.fileExplorer) {
                console.error('file-explorer not found');
                return;
            }
            const root = this.fileExplorer.fileItems['/'];
            const styles = getComputedStyle(root.titleInnerEl);
            const setup = () => {
                const shouldHide = styles.display === 'none' ||
                    styles.color === 'rgba(0, 0, 0, 0)';
                root.titleEl.toggleClass(rootHiddenClass, !revert && shouldHide);
            };
            if (styles.display !== '')
                setup();
            else {
                let count = 0;
                const doId = window.setInterval(() => {
                    if (count > 10) {
                        console.error('%o styles empty', root.titleInnerEl);
                        window.clearInterval(doId);
                    }
                    else if (styles.display === '') {
                        count++;
                    }
                    else {
                        setup();
                        window.clearInterval(doId);
                    }
                }, 100);
            }
        };
        this.initialize = (revert = false) => {
            // this.graphInteractor.updateGraphNodes();
            const leaves = this.app.workspace.getLeavesOfType('file-explorer');
            if (leaves.length > 1)
                console.error('more then one file-explorer');
            else if (leaves.length < 1)
                console.error('file-explorer not found');
            else {
                if (!this.fileExplorer)
                    this.fileExplorer = leaves[0].view;
                setupTitle(this, this.vaultHandler.vault, revert);
                // this.doHiddenRoot(revert);
                if (!revert) {
                    // this.registerEvent(
                    //     this.app.workspace.on('css-change', this.doHiddenRoot),
                    // );
                    this.app.workspace.on('layout-change', () => setTimeout(() => this.graphInteractor.updateGraphNodes(), 1));
                    this.vaultHandler.registerVaultEvent();
                    if (this.settings.showAllNumbers)
                        document.body.addClass('oz-show-all-num');
                }
                else {
                    this.app.workspace.removeEventListener('layout-change', this);
                    for (const el of document.getElementsByClassName(withSubfolderClass)) {
                        el.removeClass(withSubfolderClass);
                    }
                    document.body.removeClass(showAllNumbersClass);
                }
            }
        };
    }
    onload() {
        return __awaiter(this, void 0, void 0, function* () {
            console.log('loading FileExplorerNoteTitle');
            this.app.workspace.onLayoutReady(this.initialize);
        });
    }
    onunload() {
        console.log('unloading FileExplorerNoteTitle');
        this.initialize(true);
    }
    reloadTitle() {
        setupTitle(this, this.vaultHandler.vault);
    }
}

module.exports = FileExplorerNoteCount;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXMiOlsibm9kZV9tb2R1bGVzL3RzbGliL3RzbGliLmVzNi5qcyIsInNyYy9zcmMvbWlzYy50cyIsInNyYy9zcmMvZm9sZGVyLXRpdGxlLnRzIiwic3JjL3NyYy92YXVsdC1oYW5kbGVyLnRzIiwic3JjL3NyYy9ncmFwaC1pbnRlcmFjdG9yLnRzIiwic3JjL3NyYy9zZXR0aW5ncy50cyIsInNyYy9zcmMvbWFpbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiEgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uXHJcblxyXG5QZXJtaXNzaW9uIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBhbmQvb3IgZGlzdHJpYnV0ZSB0aGlzIHNvZnR3YXJlIGZvciBhbnlcclxucHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLlxyXG5cclxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiBBTkQgVEhFIEFVVEhPUiBESVNDTEFJTVMgQUxMIFdBUlJBTlRJRVMgV0lUSFxyXG5SRUdBUkQgVE8gVEhJUyBTT0ZUV0FSRSBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFlcclxuQU5EIEZJVE5FU1MuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1IgQkUgTElBQkxFIEZPUiBBTlkgU1BFQ0lBTCwgRElSRUNULFxyXG5JTkRJUkVDVCwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIE9SIEFOWSBEQU1BR0VTIFdIQVRTT0VWRVIgUkVTVUxUSU5HIEZST01cclxuTE9TUyBPRiBVU0UsIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1JcclxuT1RIRVIgVE9SVElPVVMgQUNUSU9OLCBBUklTSU5HIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFVTRSBPUlxyXG5QRVJGT1JNQU5DRSBPRiBUSElTIFNPRlRXQVJFLlxyXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqL1xyXG4vKiBnbG9iYWwgUmVmbGVjdCwgUHJvbWlzZSAqL1xyXG5cclxudmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbihkLCBiKSB7XHJcbiAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XHJcbiAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxyXG4gICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChiLCBwKSkgZFtwXSA9IGJbcF07IH07XHJcbiAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2V4dGVuZHMoZCwgYikge1xyXG4gICAgaWYgKHR5cGVvZiBiICE9PSBcImZ1bmN0aW9uXCIgJiYgYiAhPT0gbnVsbClcclxuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2xhc3MgZXh0ZW5kcyB2YWx1ZSBcIiArIFN0cmluZyhiKSArIFwiIGlzIG5vdCBhIGNvbnN0cnVjdG9yIG9yIG51bGxcIik7XHJcbiAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XHJcbiAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XHJcbn1cclxuXHJcbmV4cG9ydCB2YXIgX19hc3NpZ24gPSBmdW5jdGlvbigpIHtcclxuICAgIF9fYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiBfX2Fzc2lnbih0KSB7XHJcbiAgICAgICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7XHJcbiAgICAgICAgICAgIHMgPSBhcmd1bWVudHNbaV07XHJcbiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSkgdFtwXSA9IHNbcF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0O1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIF9fYXNzaWduLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3Jlc3QocywgZSkge1xyXG4gICAgdmFyIHQgPSB7fTtcclxuICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSAmJiBlLmluZGV4T2YocCkgPCAwKVxyXG4gICAgICAgIHRbcF0gPSBzW3BdO1xyXG4gICAgaWYgKHMgIT0gbnVsbCAmJiB0eXBlb2YgT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyA9PT0gXCJmdW5jdGlvblwiKVxyXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBwID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhzKTsgaSA8IHAubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKGUuaW5kZXhPZihwW2ldKSA8IDAgJiYgT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKHMsIHBbaV0pKVxyXG4gICAgICAgICAgICAgICAgdFtwW2ldXSA9IHNbcFtpXV07XHJcbiAgICAgICAgfVxyXG4gICAgcmV0dXJuIHQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2RlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKSB7XHJcbiAgICB2YXIgYyA9IGFyZ3VtZW50cy5sZW5ndGgsIHIgPSBjIDwgMyA/IHRhcmdldCA6IGRlc2MgPT09IG51bGwgPyBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSkgOiBkZXNjLCBkO1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcclxuICAgIGVsc2UgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIGlmIChkID0gZGVjb3JhdG9yc1tpXSkgciA9IChjIDwgMyA/IGQocikgOiBjID4gMyA/IGQodGFyZ2V0LCBrZXksIHIpIDogZCh0YXJnZXQsIGtleSkpIHx8IHI7XHJcbiAgICByZXR1cm4gYyA+IDMgJiYgciAmJiBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHIpLCByO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19wYXJhbShwYXJhbUluZGV4LCBkZWNvcmF0b3IpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0LCBrZXkpIHsgZGVjb3JhdG9yKHRhcmdldCwga2V5LCBwYXJhbUluZGV4KTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19tZXRhZGF0YShtZXRhZGF0YUtleSwgbWV0YWRhdGFWYWx1ZSkge1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0Lm1ldGFkYXRhID09PSBcImZ1bmN0aW9uXCIpIHJldHVybiBSZWZsZWN0Lm1ldGFkYXRhKG1ldGFkYXRhS2V5LCBtZXRhZGF0YVZhbHVlKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXdhaXRlcih0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcclxuICAgIGZ1bmN0aW9uIGFkb3B0KHZhbHVlKSB7IHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFAgPyB2YWx1ZSA6IG5ldyBQKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJlc29sdmUodmFsdWUpOyB9KTsgfVxyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2dlbmVyYXRvcih0aGlzQXJnLCBib2R5KSB7XHJcbiAgICB2YXIgXyA9IHsgbGFiZWw6IDAsIHNlbnQ6IGZ1bmN0aW9uKCkgeyBpZiAodFswXSAmIDEpIHRocm93IHRbMV07IHJldHVybiB0WzFdOyB9LCB0cnlzOiBbXSwgb3BzOiBbXSB9LCBmLCB5LCB0LCBnO1xyXG4gICAgcmV0dXJuIGcgPSB7IG5leHQ6IHZlcmIoMCksIFwidGhyb3dcIjogdmVyYigxKSwgXCJyZXR1cm5cIjogdmVyYigyKSB9LCB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgKGdbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSksIGc7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgcmV0dXJuIGZ1bmN0aW9uICh2KSB7IHJldHVybiBzdGVwKFtuLCB2XSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHN0ZXAob3ApIHtcclxuICAgICAgICBpZiAoZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XHJcbiAgICAgICAgd2hpbGUgKF8pIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChmID0gMSwgeSAmJiAodCA9IG9wWzBdICYgMiA/IHlbXCJyZXR1cm5cIl0gOiBvcFswXSA/IHlbXCJ0aHJvd1wiXSB8fCAoKHQgPSB5W1wicmV0dXJuXCJdKSAmJiB0LmNhbGwoeSksIDApIDogeS5uZXh0KSAmJiAhKHQgPSB0LmNhbGwoeSwgb3BbMV0pKS5kb25lKSByZXR1cm4gdDtcclxuICAgICAgICAgICAgaWYgKHkgPSAwLCB0KSBvcCA9IFtvcFswXSAmIDIsIHQudmFsdWVdO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKG9wWzBdKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDA6IGNhc2UgMTogdCA9IG9wOyBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgNDogXy5sYWJlbCsrOyByZXR1cm4geyB2YWx1ZTogb3BbMV0sIGRvbmU6IGZhbHNlIH07XHJcbiAgICAgICAgICAgICAgICBjYXNlIDU6IF8ubGFiZWwrKzsgeSA9IG9wWzFdOyBvcCA9IFswXTsgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDc6IG9wID0gXy5vcHMucG9wKCk7IF8udHJ5cy5wb3AoKTsgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghKHQgPSBfLnRyeXMsIHQgPSB0Lmxlbmd0aCA+IDAgJiYgdFt0Lmxlbmd0aCAtIDFdKSAmJiAob3BbMF0gPT09IDYgfHwgb3BbMF0gPT09IDIpKSB7IF8gPSAwOyBjb250aW51ZTsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gMyAmJiAoIXQgfHwgKG9wWzFdID4gdFswXSAmJiBvcFsxXSA8IHRbM10pKSkgeyBfLmxhYmVsID0gb3BbMV07IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wWzBdID09PSA2ICYmIF8ubGFiZWwgPCB0WzFdKSB7IF8ubGFiZWwgPSB0WzFdOyB0ID0gb3A7IGJyZWFrOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHQgJiYgXy5sYWJlbCA8IHRbMl0pIHsgXy5sYWJlbCA9IHRbMl07IF8ub3BzLnB1c2gob3ApOyBicmVhazsgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0WzJdKSBfLm9wcy5wb3AoKTtcclxuICAgICAgICAgICAgICAgICAgICBfLnRyeXMucG9wKCk7IGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG9wID0gYm9keS5jYWxsKHRoaXNBcmcsIF8pO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgb3AgPSBbNiwgZV07IHkgPSAwOyB9IGZpbmFsbHkgeyBmID0gdCA9IDA7IH1cclxuICAgICAgICBpZiAob3BbMF0gJiA1KSB0aHJvdyBvcFsxXTsgcmV0dXJuIHsgdmFsdWU6IG9wWzBdID8gb3BbMV0gOiB2b2lkIDAsIGRvbmU6IHRydWUgfTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IHZhciBfX2NyZWF0ZUJpbmRpbmcgPSBPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XHJcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xyXG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xyXG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcclxuICAgIG9bazJdID0gbVtrXTtcclxufSk7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19leHBvcnRTdGFyKG0sIG8pIHtcclxuICAgIGZvciAodmFyIHAgaW4gbSkgaWYgKHAgIT09IFwiZGVmYXVsdFwiICYmICFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobywgcCkpIF9fY3JlYXRlQmluZGluZyhvLCBtLCBwKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fdmFsdWVzKG8pIHtcclxuICAgIHZhciBzID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7XHJcbiAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTtcclxuICAgIGlmIChvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gXCJudW1iZXJcIikgcmV0dXJuIHtcclxuICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmIChvICYmIGkgPj0gby5sZW5ndGgpIG8gPSB2b2lkIDA7XHJcbiAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gXCJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLlwiIDogXCJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuXCIpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19yZWFkKG8sIG4pIHtcclxuICAgIHZhciBtID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9bU3ltYm9sLml0ZXJhdG9yXTtcclxuICAgIGlmICghbSkgcmV0dXJuIG87XHJcbiAgICB2YXIgaSA9IG0uY2FsbChvKSwgciwgYXIgPSBbXSwgZTtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgd2hpbGUgKChuID09PSB2b2lkIDAgfHwgbi0tID4gMCkgJiYgIShyID0gaS5uZXh0KCkpLmRvbmUpIGFyLnB1c2goci52YWx1ZSk7XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZXJyb3IpIHsgZSA9IHsgZXJyb3I6IGVycm9yIH07IH1cclxuICAgIGZpbmFsbHkge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChyICYmICFyLmRvbmUgJiYgKG0gPSBpW1wicmV0dXJuXCJdKSkgbS5jYWxsKGkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmaW5hbGx5IHsgaWYgKGUpIHRocm93IGUuZXJyb3I7IH1cclxuICAgIH1cclxuICAgIHJldHVybiBhcjtcclxufVxyXG5cclxuLyoqIEBkZXByZWNhdGVkICovXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3NwcmVhZCgpIHtcclxuICAgIGZvciAodmFyIGFyID0gW10sIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKVxyXG4gICAgICAgIGFyID0gYXIuY29uY2F0KF9fcmVhZChhcmd1bWVudHNbaV0pKTtcclxuICAgIHJldHVybiBhcjtcclxufVxyXG5cclxuLyoqIEBkZXByZWNhdGVkICovXHJcbmV4cG9ydCBmdW5jdGlvbiBfX3NwcmVhZEFycmF5cygpIHtcclxuICAgIGZvciAodmFyIHMgPSAwLCBpID0gMCwgaWwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgaWw7IGkrKykgcyArPSBhcmd1bWVudHNbaV0ubGVuZ3RoO1xyXG4gICAgZm9yICh2YXIgciA9IEFycmF5KHMpLCBrID0gMCwgaSA9IDA7IGkgPCBpbDsgaSsrKVxyXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxyXG4gICAgICAgICAgICByW2tdID0gYVtqXTtcclxuICAgIHJldHVybiByO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19zcHJlYWRBcnJheSh0bywgZnJvbSwgcGFjaykge1xyXG4gICAgaWYgKHBhY2sgfHwgYXJndW1lbnRzLmxlbmd0aCA9PT0gMikgZm9yICh2YXIgaSA9IDAsIGwgPSBmcm9tLmxlbmd0aCwgYXI7IGkgPCBsOyBpKyspIHtcclxuICAgICAgICBpZiAoYXIgfHwgIShpIGluIGZyb20pKSB7XHJcbiAgICAgICAgICAgIGlmICghYXIpIGFyID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZnJvbSwgMCwgaSk7XHJcbiAgICAgICAgICAgIGFyW2ldID0gZnJvbVtpXTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdG8uY29uY2F0KGFyIHx8IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGZyb20pKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fYXdhaXQodikge1xyXG4gICAgcmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBfX2F3YWl0ID8gKHRoaXMudiA9IHYsIHRoaXMpIDogbmV3IF9fYXdhaXQodik7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jR2VuZXJhdG9yKHRoaXNBcmcsIF9hcmd1bWVudHMsIGdlbmVyYXRvcikge1xyXG4gICAgaWYgKCFTeW1ib2wuYXN5bmNJdGVyYXRvcikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN5bWJvbC5hc3luY0l0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLlwiKTtcclxuICAgIHZhciBnID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pLCBpLCBxID0gW107XHJcbiAgICByZXR1cm4gaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGk7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4pIHsgaWYgKGdbbl0pIGlbbl0gPSBmdW5jdGlvbiAodikgeyByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKGEsIGIpIHsgcS5wdXNoKFtuLCB2LCBhLCBiXSkgPiAxIHx8IHJlc3VtZShuLCB2KTsgfSk7IH07IH1cclxuICAgIGZ1bmN0aW9uIHJlc3VtZShuLCB2KSB7IHRyeSB7IHN0ZXAoZ1tuXSh2KSk7IH0gY2F0Y2ggKGUpIHsgc2V0dGxlKHFbMF1bM10sIGUpOyB9IH1cclxuICAgIGZ1bmN0aW9uIHN0ZXAocikgeyByLnZhbHVlIGluc3RhbmNlb2YgX19hd2FpdCA/IFByb21pc2UucmVzb2x2ZShyLnZhbHVlLnYpLnRoZW4oZnVsZmlsbCwgcmVqZWN0KSA6IHNldHRsZShxWzBdWzJdLCByKTsgfVxyXG4gICAgZnVuY3Rpb24gZnVsZmlsbCh2YWx1ZSkgeyByZXN1bWUoXCJuZXh0XCIsIHZhbHVlKTsgfVxyXG4gICAgZnVuY3Rpb24gcmVqZWN0KHZhbHVlKSB7IHJlc3VtZShcInRocm93XCIsIHZhbHVlKTsgfVxyXG4gICAgZnVuY3Rpb24gc2V0dGxlKGYsIHYpIHsgaWYgKGYodiksIHEuc2hpZnQoKSwgcS5sZW5ndGgpIHJlc3VtZShxWzBdWzBdLCBxWzBdWzFdKTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19hc3luY0RlbGVnYXRvcihvKSB7XHJcbiAgICB2YXIgaSwgcDtcclxuICAgIHJldHVybiBpID0ge30sIHZlcmIoXCJuZXh0XCIpLCB2ZXJiKFwidGhyb3dcIiwgZnVuY3Rpb24gKGUpIHsgdGhyb3cgZTsgfSksIHZlcmIoXCJyZXR1cm5cIiksIGlbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGk7XHJcbiAgICBmdW5jdGlvbiB2ZXJiKG4sIGYpIHsgaVtuXSA9IG9bbl0gPyBmdW5jdGlvbiAodikgeyByZXR1cm4gKHAgPSAhcCkgPyB7IHZhbHVlOiBfX2F3YWl0KG9bbl0odikpLCBkb25lOiBuID09PSBcInJldHVyblwiIH0gOiBmID8gZih2KSA6IHY7IH0gOiBmOyB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jVmFsdWVzKG8pIHtcclxuICAgIGlmICghU3ltYm9sLmFzeW5jSXRlcmF0b3IpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJTeW1ib2wuYXN5bmNJdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7XHJcbiAgICB2YXIgbSA9IG9bU3ltYm9sLmFzeW5jSXRlcmF0b3JdLCBpO1xyXG4gICAgcmV0dXJuIG0gPyBtLmNhbGwobykgOiAobyA9IHR5cGVvZiBfX3ZhbHVlcyA9PT0gXCJmdW5jdGlvblwiID8gX192YWx1ZXMobykgOiBvW1N5bWJvbC5pdGVyYXRvcl0oKSwgaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGkpO1xyXG4gICAgZnVuY3Rpb24gdmVyYihuKSB7IGlbbl0gPSBvW25dICYmIGZ1bmN0aW9uICh2KSB7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7IHYgPSBvW25dKHYpLCBzZXR0bGUocmVzb2x2ZSwgcmVqZWN0LCB2LmRvbmUsIHYudmFsdWUpOyB9KTsgfTsgfVxyXG4gICAgZnVuY3Rpb24gc2V0dGxlKHJlc29sdmUsIHJlamVjdCwgZCwgdikgeyBQcm9taXNlLnJlc29sdmUodikudGhlbihmdW5jdGlvbih2KSB7IHJlc29sdmUoeyB2YWx1ZTogdiwgZG9uZTogZCB9KTsgfSwgcmVqZWN0KTsgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19tYWtlVGVtcGxhdGVPYmplY3QoY29va2VkLCByYXcpIHtcclxuICAgIGlmIChPYmplY3QuZGVmaW5lUHJvcGVydHkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNvb2tlZCwgXCJyYXdcIiwgeyB2YWx1ZTogcmF3IH0pOyB9IGVsc2UgeyBjb29rZWQucmF3ID0gcmF3OyB9XHJcbiAgICByZXR1cm4gY29va2VkO1xyXG59O1xyXG5cclxudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9IE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xyXG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcclxuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2ltcG9ydFN0YXIobW9kKSB7XHJcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xyXG4gICAgdmFyIHJlc3VsdCA9IHt9O1xyXG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xyXG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcclxuICAgIHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBfX2ltcG9ydERlZmF1bHQobW9kKSB7XHJcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IGRlZmF1bHQ6IG1vZCB9O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gX19jbGFzc1ByaXZhdGVGaWVsZEdldChyZWNlaXZlciwgc3RhdGUsIGtpbmQsIGYpIHtcclxuICAgIGlmIChraW5kID09PSBcImFcIiAmJiAhZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlByaXZhdGUgYWNjZXNzb3Igd2FzIGRlZmluZWQgd2l0aG91dCBhIGdldHRlclwiKTtcclxuICAgIGlmICh0eXBlb2Ygc3RhdGUgPT09IFwiZnVuY3Rpb25cIiA/IHJlY2VpdmVyICE9PSBzdGF0ZSB8fCAhZiA6ICFzdGF0ZS5oYXMocmVjZWl2ZXIpKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IHJlYWQgcHJpdmF0ZSBtZW1iZXIgZnJvbSBhbiBvYmplY3Qgd2hvc2UgY2xhc3MgZGlkIG5vdCBkZWNsYXJlIGl0XCIpO1xyXG4gICAgcmV0dXJuIGtpbmQgPT09IFwibVwiID8gZiA6IGtpbmQgPT09IFwiYVwiID8gZi5jYWxsKHJlY2VpdmVyKSA6IGYgPyBmLnZhbHVlIDogc3RhdGUuZ2V0KHJlY2VpdmVyKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIF9fY2xhc3NQcml2YXRlRmllbGRTZXQocmVjZWl2ZXIsIHN0YXRlLCB2YWx1ZSwga2luZCwgZikge1xyXG4gICAgaWYgKGtpbmQgPT09IFwibVwiKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiUHJpdmF0ZSBtZXRob2QgaXMgbm90IHdyaXRhYmxlXCIpO1xyXG4gICAgaWYgKGtpbmQgPT09IFwiYVwiICYmICFmKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiUHJpdmF0ZSBhY2Nlc3NvciB3YXMgZGVmaW5lZCB3aXRob3V0IGEgc2V0dGVyXCIpO1xyXG4gICAgaWYgKHR5cGVvZiBzdGF0ZSA9PT0gXCJmdW5jdGlvblwiID8gcmVjZWl2ZXIgIT09IHN0YXRlIHx8ICFmIDogIXN0YXRlLmhhcyhyZWNlaXZlcikpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3Qgd3JpdGUgcHJpdmF0ZSBtZW1iZXIgdG8gYW4gb2JqZWN0IHdob3NlIGNsYXNzIGRpZCBub3QgZGVjbGFyZSBpdFwiKTtcclxuICAgIHJldHVybiAoa2luZCA9PT0gXCJhXCIgPyBmLmNhbGwocmVjZWl2ZXIsIHZhbHVlKSA6IGYgPyBmLnZhbHVlID0gdmFsdWUgOiBzdGF0ZS5zZXQocmVjZWl2ZXIsIHZhbHVlKSksIHZhbHVlO1xyXG59XHJcbiIsImltcG9ydCB7XG4gICAgQUZJdGVtLFxuICAgIEZpbGVFeHBsb3JlcixcbiAgICBGb2xkZXJJdGVtLFxuICAgIFRBYnN0cmFjdEZpbGUsXG4gICAgVEZvbGRlcixcbn0gZnJvbSAnb2JzaWRpYW4nO1xuXG5leHBvcnQgY29uc3Qgd2l0aFN1YmZvbGRlckNsYXNzID0gJ296LXdpdGgtc3ViZm9sZGVyJztcbmV4cG9ydCBjb25zdCBzaG93QWxsTnVtYmVyc0NsYXNzID0gJ296LXNob3ctYWxsLW51bSc7XG5leHBvcnQgY29uc3Qgcm9vdEhpZGRlbkNsYXNzID0gJ296LXJvb3QtaGlkZGVuJztcblxuZXhwb3J0IGNvbnN0IGlzRm9sZGVyID0gKGl0ZW06IEFGSXRlbSk6IGl0ZW0gaXMgRm9sZGVySXRlbSA9PlxuICAgIChpdGVtIGFzIEZvbGRlckl0ZW0pLmZpbGUgaW5zdGFuY2VvZiBURm9sZGVyO1xuXG5leHBvcnQgY29uc3QgaXRlcmF0ZUl0ZW1zID0gKFxuICAgIGl0ZW1zOiBGaWxlRXhwbG9yZXJbJ2ZpbGVJdGVtcyddLFxuICAgIGNhbGxiYWNrOiAoaXRlbTogQUZJdGVtKSA9PiBhbnksXG4pOiB2b2lkID0+IHtcbiAgICBmb3IgKGNvbnN0IGtleSBpbiBpdGVtcykge1xuICAgICAgICBpZiAoIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChpdGVtcywga2V5KSkgY29udGludWU7XG4gICAgICAgIGNhbGxiYWNrKGl0ZW1zW2tleV0pO1xuICAgIH1cbn07XG5cbmV4cG9ydCBjb25zdCBlcXVhbHMgPSAoYXJyMTogYW55LCBhcnIyOiBhbnkpID0+IHtcbiAgICAvLyBpZiB0aGUgb3RoZXIgYXJyYXkgaXMgYSBmYWxzeSB2YWx1ZSwgcmV0dXJuXG4gICAgaWYgKCFBcnJheS5pc0FycmF5KGFycjEpIHx8ICFBcnJheS5pc0FycmF5KGFycjIpKSByZXR1cm4gZmFsc2U7XG5cbiAgICAvLyBjb21wYXJlIGxlbmd0aHMgLSBjYW4gc2F2ZSBhIGxvdCBvZiB0aW1lXG4gICAgaWYgKGFycjEubGVuZ3RoICE9IGFycjIubGVuZ3RoKSByZXR1cm4gZmFsc2U7XG5cbiAgICByZXR1cm4gYXJyMS5ldmVyeSgodiwgaSkgPT4gdiA9PT0gYXJyMltpXSk7XG59OyIsImltcG9ydCAnLi9zdHlsZXMvZm9sZGVyLXRpdGxlLmNzcyc7XG5cbmltcG9ydCBGaWxlRXhwbG9yZXJOb3RlQ291bnQgZnJvbSAnbWFpbic7XG5pbXBvcnQge1xuICAgIGlzRm9sZGVyLFxuICAgIGl0ZXJhdGVJdGVtcyxcbiAgICB3aXRoU3ViZm9sZGVyQ2xhc3MsXG59IGZyb20gJ21pc2MnO1xuaW1wb3J0IHsgQUZJdGVtLCBGb2xkZXJJdGVtLCBGaWxlSXRlbSwgVEZvbGRlciwgVEZpbGUsIFZhdWx0IH0gZnJvbSAnb2JzaWRpYW4nO1xuXG5leHBvcnQgY29uc3Qgc2V0dXBUaXRsZSA9IChwbHVnaW46IEZpbGVFeHBsb3Jlck5vdGVDb3VudCwgdmF1bHQ6IFZhdWx0LCByZXZlcnQgPSBmYWxzZSkgPT4ge1xuICAgIGlmICghcGx1Z2luLmZpbGVFeHBsb3JlcikgdGhyb3cgbmV3IEVycm9yKCdmaWxlRXhwbG9yZXIgbm90IGZvdW5kJyk7XG5cbiAgICBpdGVyYXRlSXRlbXMocGx1Z2luLmZpbGVFeHBsb3Jlci5maWxlSXRlbXMsIChpdGVtOiBBRkl0ZW0pID0+IHtcbiAgICAgICAgaWYgKCFpc0ZvbGRlcihpdGVtKSkge1xuICAgICAgICAgICAgc2V0VGl0bGUoaXRlbSwgdmF1bHQpO1xuICAgICAgICB9XG4gICAgfSk7XG59O1xuXG5leHBvcnQgY29uc3Qgc2V0VGl0bGUgPSAoaXRlbTogRmlsZUl0ZW0sIHZhdWx0OiBWYXVsdCkgPT4ge1xuICAgIGlmIChpdGVtLmZpbGUuZXh0ZW5zaW9uICE9IFwibWRcIikgeyByZXR1cm4gfVxuXG4gICAgbGV0IGlkTWF0Y2ggPSBpdGVtLmZpbGUuYmFzZW5hbWUubWF0Y2goLyhbMC05XSt8W2Etel0rKS9nKSFcbiAgICBpZiAoaWRNYXRjaCkge1xuICAgICAgICBsZXQgaW5kZW50Q291bnQgPSAoaWRNYXRjaC5sZW5ndGggLSAxKVxuICAgICAgICBsZXQgaW5kZW50U3RyID0gKGluZGVudENvdW50ICogMjApLnRvU3RyaW5nKCkgKyBcInB4XCJcbiAgICAgICAgaXRlbS50aXRsZUVsLnN0eWxlLm1hcmdpbkxlZnQgPSBpbmRlbnRTdHJcbiAgICB9XG5cbiAgICB2YXVsdC5yZWFkKGl0ZW0uZmlsZSkudGhlbihmdW5jdGlvbiAodmFsKSB7XG4gICAgICAgIGNvbnN0IG1hdGNoID0gLyMgKC4rKVxccyovLmV4ZWModmFsKTtcbiAgICAgICAgaWYgKG1hdGNoICE9IG51bGwpIHtcbiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBtYXRjaFsxXTtcbiAgICAgICAgICAgIGl0ZW0udGl0bGVJbm5lckVsLmlubmVyVGV4dCA9IG5hbWU7XG4gICAgICAgIH0gXG4gICAgfSkuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhgRXJyb3IgcmV0cmlldmluZyBjb250ZW50IG9mICR7aXRlbS5maWxlLnBhdGh9OiAke2Vycm9yfWApXG4gICAgfSk7XG59XG5cbmV4cG9ydCBjb25zdCB1cGRhdGVUaXRsZSA9IChcbiAgICB0YXJnZXRMaXN0OiBzdHJpbmdbXSwgXG4gICAgcGx1Z2luOiBGaWxlRXhwbG9yZXJOb3RlQ291bnQsIFxuICAgIHZhdWx0OiBWYXVsdFxuKSA9PiB7XG4gICAgY29uc3QgeyBmaWxlRXhwbG9yZXIgfSA9IHBsdWdpbjtcbiAgICBpZiAoIWZpbGVFeHBsb3Jlcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdmaWxlRXhwbG9yZXIgbWlzc2luZycpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGZvciAoY29uc3QgcGF0aCBvZiB0YXJnZXRMaXN0KSB7XG4gICAgICAgIC8vIGNoZWNrIGlmIHBhdGggYXZhaWxhYmxlXG4gICAgICAgIGlmICghZmlsZUV4cGxvcmVyLmZpbGVJdGVtc1twYXRoXSkgY29udGludWU7XG4gICAgICAgIHNldFRpdGxlKGZpbGVFeHBsb3Jlci5maWxlSXRlbXNbcGF0aF0gYXMgRmlsZUl0ZW0sIHZhdWx0KTtcbiAgICB9XG59O1xuXG5jb25zdCByZW1vdmVUaXRsZSA9IChpdGVtOiBGaWxlSXRlbSkgPT4ge1xuICAgIGlmIChpdGVtLnRpdGxlRWwuZGF0YXNldFsnbmFtZSddKSBkZWxldGUgaXRlbS50aXRsZUVsLmRhdGFzZXRbJ25hbWUnXTtcbiAgICBpdGVtLnRpdGxlRWwucmVtb3ZlQ2xhc3Mod2l0aFN1YmZvbGRlckNsYXNzKTtcbn07IiwiaW1wb3J0IHsgdXBkYXRlVGl0bGUgfSBmcm9tICdmb2xkZXItdGl0bGUnO1xuaW1wb3J0IEZpbGVFeHBsb3Jlck5vdGVDb3VudCBmcm9tICdtYWluJztcbmltcG9ydCB7IEFwcCwgZGVib3VuY2UsIFRBYnN0cmFjdEZpbGUsIFZhdWx0IH0gZnJvbSAnb2JzaWRpYW4nO1xuXG5leHBvcnQgY2xhc3MgVmF1bHRIYW5kbGVyIHtcbiAgICB3YWl0aW5nTGlzdDogc3RyaW5nW10gPSBbXTtcbiAgICBnZXQgYXBwKCk6IEFwcCB7XG4gICAgICAgIHJldHVybiB0aGlzLnBsdWdpbi5hcHA7XG4gICAgfVxuICAgIGdldCB2YXVsdCgpOiBWYXVsdCB7XG4gICAgICAgIHJldHVybiB0aGlzLnBsdWdpbi5hcHAudmF1bHQ7XG4gICAgfVxuICAgIHBsdWdpbjogRmlsZUV4cGxvcmVyTm90ZUNvdW50O1xuICAgIGNvbnN0cnVjdG9yKHBsdWdpbjogRmlsZUV4cGxvcmVyTm90ZUNvdW50KSB7XG4gICAgICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICAgIH1cblxuICAgIHVwZGF0ZSA9IGRlYm91bmNlKFxuICAgICAgICAoKSA9PiB1cGRhdGVUaXRsZSh0aGlzLndhaXRpbmdMaXN0LCB0aGlzLnBsdWdpbiwgdGhpcy52YXVsdCksXG4gICAgICAgIDUwMCxcbiAgICAgICAgdHJ1ZSxcbiAgICApO1xuXG4gICAgaGFuZGxlciA9ICguLi5hcmdzOiAoc3RyaW5nIHwgVEFic3RyYWN0RmlsZSlbXSkgPT4ge1xuICAgICAgICBmb3IgKGNvbnN0IGFyZyBvZiBhcmdzKSB7XG4gICAgICAgICAgICBjb25zdCBwYXRoID0gYXJnIGluc3RhbmNlb2YgVEFic3RyYWN0RmlsZSA/IGFyZy5wYXRoIDogYXJnO1xuICAgICAgICAgICAgdGhpcy53YWl0aW5nTGlzdC5wdXNoKHBhdGgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudXBkYXRlKCk7XG4gICAgfTtcblxuICAgIHJlZ2lzdGVyVmF1bHRFdmVudCA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5wbHVnaW4ucmVnaXN0ZXJFdmVudCh0aGlzLnZhdWx0Lm9uKCdjcmVhdGUnLCB0aGlzLmhhbmRsZXIpKTtcbiAgICAgICAgdGhpcy5wbHVnaW4ucmVnaXN0ZXJFdmVudCh0aGlzLnZhdWx0Lm9uKCdyZW5hbWUnLCB0aGlzLmhhbmRsZXIpKTtcbiAgICAgICAgdGhpcy5wbHVnaW4ucmVnaXN0ZXJFdmVudCh0aGlzLnZhdWx0Lm9uKCdkZWxldGUnLCB0aGlzLmhhbmRsZXIpKTtcbiAgICB9O1xufVxuIiwiaW1wb3J0IEZpbGVFeHBsb3Jlck5vdGVDb3VudCBmcm9tICdtYWluJztcbi8vQHRzLWlnbm9yZVxuaW1wb3J0IHsgR3JhcGhWaWV3IH0gZnJvbSAnb2JzaWRpYW4nO1xuXG5leHBvcnQgY2xhc3MgR3JhcGhJbnRlcmFjdG9yIHtcblx0XG5cdHBsdWdpbjogRmlsZUV4cGxvcmVyTm90ZUNvdW50XG5cblx0Y29uc3RydWN0b3IocGx1Z2luOiBGaWxlRXhwbG9yZXJOb3RlQ291bnQpIHtcbiAgICAgICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgfVxuXG5cdHVwZGF0ZUdyYXBoTm9kZXMoKSB7XG5cdCAgICBsZXQgZ3JhcGggPSB0aGlzLmdldEdyYXBoKCk7XG5cdCAgICBpZiAoZ3JhcGggPT0gdW5kZWZpbmVkIHx8IGdyYXBoLnJlbmRlcmVyID09IHVuZGVmaW5lZCkgeyByZXR1cm4gfVxuXG5cdCAgICAvL0B0cy1pZ25vcmVcblx0ICAgIGZvcihjb25zdCBub2RlIG9mIGdyYXBoLnJlbmRlcmVyLm5vZGVzKSB7XG5cdCAgICAgICAgbGV0IHRleHQgPSB0aGlzLmdldERpc3BsYXlUZXh0KG5vZGUpO1xuXHQgICAgICAgIG5vZGUuZ2V0RGlzcGxheVRleHQgPSAoKSA9PiB0ZXh0O1xuXHQgICAgICAgIFxuXHQgICAgICAgIG5vZGUuZGlkU2V0VGl0bGUgPSB0cnVlO1xuXHQgICAgICAgIFxuXHQgICAgICAgIG5vZGUuaW5pdEdyYXBoaWNzKClcblx0ICAgIH1cblxuXHQgICAgZ3JhcGgucmVuZGVyZXIub25JZnJhbWVMb2FkKClcblx0fVxuXG5cdC8vQHRzLWlnbm9yZVxuXHRnZXREaXNwbGF5VGV4dChub2RlKTogc3RyaW5nIHtcblx0ICAgIC8vQHRzLWlnbm9yZVxuXHQgICAgbGV0IGNhY2hlID0gdGhpcy5wbHVnaW4uYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0Q2FjaGUobm9kZS5pZClcblx0ICAgIGlmIChjYWNoZSA9PSB1bmRlZmluZWQgfHwgY2FjaGUuaGVhZGluZ3MgPT0gdW5kZWZpbmVkKSB7IHJldHVybiBub2RlLmlkIH1cblx0ICAgIGlmIChjYWNoZS5oZWFkaW5ncy5sZW5ndGggPT0gMCkgeyByZXR1cm4gbm9kZS5pZCB9XG5cdCAgICByZXR1cm4gY2FjaGUuaGVhZGluZ3NbMF0uaGVhZGluZ1xuXHR9XG5cblxuXHRnZXRHcmFwaE9mVHlwZSh0eXBlOiBzdHJpbmcpOiBHcmFwaFZpZXcge1xuXHQgICAgLy9AdHMtaWdub3JlXG5cdCAgICBsZXQgbGVhdmVzID0gdGhpcy5wbHVnaW4uYXBwLndvcmtzcGFjZS5nZXRMZWF2ZXNPZlR5cGUodHlwZSkgICAgLy8gdGhpcyBmdW5jdGlvbiB0YWtlcyBhIHN0cmluZyBpbnN0ZWFkIG9mIHZpZXcgb2JqZWN0LCBzbyBpdCdzIGVhc2llclxuICAgICAgICAvL0B0cy1pZ25vcmVcbiAgICAgICAgZm9yIChjb25zdCBsZWFmIG9mIGxlYXZlcykge1xuICAgICAgICAgICBpZihsZWFmLnZpZXcuZ2V0Vmlld1R5cGUoKSA9PSB0eXBlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJmb3VuZCBncmFwaCB2aWV3XCIpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGxlYWYudmlldyBhcyBHcmFwaFZpZXdcbiAgICAgICAgICAgIH0gXG4gICAgICAgIH1cblx0fVxuXG5cdGdldEdyYXBoKCk6IEdyYXBoVmlldyB7XG5cdCAgICAvL0B0cy1pZ25vcmVcblx0ICAgIGlmICh0aGlzLnBsdWdpbi5hcHAuaW50ZXJuYWxQbHVnaW5zLmdldFBsdWdpbkJ5SWQoJ2dyYXBoJykpIHsgICAgICAgIC8vIG5vIG5lZWQgdG8gYm90aGVyIGlmIHRoZSBncmFwaCBpcyBkaXNhYmxlZFxuXHQgICAgICAgIHJldHVybiB0aGlzLmdldEdyYXBoT2ZUeXBlKCdncmFwaCcpID8/IHRoaXMuZ2V0R3JhcGhPZlR5cGUoJ2xvY2FsZ3JhcGgnKVxuXHQgICAgfVxuXHR9XG59IiwiaW1wb3J0IHsgZXF1YWxzIH0gZnJvbSAnbWlzYyc7XG5pbXBvcnQgeyBBcHAsIGRlYm91bmNlLCBQbHVnaW5TZXR0aW5nVGFiLCBTZXR0aW5nIH0gZnJvbSAnb2JzaWRpYW4nO1xuXG5pbXBvcnQgRmlsZUV4cGxvcmVyTm90ZUNvdW50IGZyb20gJy4vbWFpbic7XG5cbmV4cG9ydCBpbnRlcmZhY2UgRkVOb3RlQ291bnRTZXR0aW5ncyB7XG4gICAgc2hvd0FsbE51bWJlcnM6IGJvb2xlYW47XG4gICAgZmlsdGVyTGlzdDogc3RyaW5nW107XG4gICAgYmxhY2tsaXN0OiBib29sZWFuO1xufVxuXG5leHBvcnQgY29uc3QgREVGQVVMVF9TRVRUSU5HUzogRkVOb3RlQ291bnRTZXR0aW5ncyA9IHtcbiAgICBzaG93QWxsTnVtYmVyczogZmFsc2UsXG4gICAgZmlsdGVyTGlzdDogWydtZCddLFxuICAgIGJsYWNrbGlzdDogZmFsc2UsXG59O1xuXG5leHBvcnQgY2xhc3MgRkVOb3RlQ291bnRTZXR0aW5nVGFiIGV4dGVuZHMgUGx1Z2luU2V0dGluZ1RhYiB7XG4gICAgcGx1Z2luOiBGaWxlRXhwbG9yZXJOb3RlQ291bnQ7XG5cbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBGaWxlRXhwbG9yZXJOb3RlQ291bnQpIHtcbiAgICAgICAgc3VwZXIoYXBwLCBwbHVnaW4pO1xuICAgICAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcbiAgICB9XG5cbiAgICBnZXQgc2hvd09ubHlOb3RlVmFsdWUoKTogYm9vbGVhbiB7XG4gICAgICAgIGNvbnN0IHsgc2V0dGluZ3MgfSA9IHRoaXMucGx1Z2luO1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgc2V0dGluZ3MuYmxhY2tsaXN0ID09PSBERUZBVUxUX1NFVFRJTkdTLmJsYWNrbGlzdCAmJlxuICAgICAgICAgICAgZXF1YWxzKHNldHRpbmdzLmZpbHRlckxpc3QsIERFRkFVTFRfU0VUVElOR1MuZmlsdGVyTGlzdClcbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBzZXQgc2hvd09ubHlOb3RlVmFsdWUodmFsdWU6IGJvb2xlYW4pIHtcbiAgICAgICAgY29uc3QgeyBibGFja2xpc3QsIGZpbHRlckxpc3QgfSA9IERFRkFVTFRfU0VUVElOR1M7XG4gICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmJsYWNrbGlzdCA9IGJsYWNrbGlzdDtcbiAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICAvLyBkbyBkZWVwIGNvcHlcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmZpbHRlckxpc3QgPSBBcnJheS5mcm9tKGZpbHRlckxpc3QpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZmlsdGVyTGlzdC5sZW5ndGggPSAwO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZGlzcGxheSgpOiB2b2lkIHtcbiAgICAgICAgbGV0IHsgY29udGFpbmVyRWwgfSA9IHRoaXM7XG4gICAgICAgIGNvbnRhaW5lckVsLmVtcHR5KCk7XG4gICAgICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKCdoMicsIHtcbiAgICAgICAgICAgIHRleHQ6ICdGaWxlIEV4cGxvcmVyIE5vdGUgQ291bnQgU2V0dGluZ3MnLFxuICAgICAgICB9KTtcblxuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKCdTaG93IEFsbCBOdW1iZXJzJylcbiAgICAgICAgICAgIC5zZXREZXNjKFxuICAgICAgICAgICAgICAgICdUdXJuIG9uIHRoaXMgb3B0aW9uIGlmIHlvdSB3YW50IHRvIHNlZSB0aGUgbnVtYmVyIG9mIG5vdGVzIGV2ZW4gYWZ0ZXIgeW91IGV4cGFuZCB0aGUgY29sbGFwc2VkIGZvbGRlcnMnLFxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlKSA9PlxuICAgICAgICAgICAgICAgIHRvZ2dsZVxuICAgICAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3Muc2hvd0FsbE51bWJlcnMpXG4gICAgICAgICAgICAgICAgICAgIC5vbkNoYW5nZSgodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkudG9nZ2xlQ2xhc3MoJ296LXNob3ctYWxsLW51bScsIHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnNob3dBbGxOdW1iZXJzID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICApO1xuICAgICAgICB0aGlzLmZpbHRlck9wdCgpO1xuICAgIH1cblxuICAgIGZpbHRlck9wdCgpOiB2b2lkIHtcbiAgICAgICAgbmV3IFNldHRpbmcodGhpcy5jb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKCdTaG93IE9ubHkgTWFya2Rvd24gTm90ZXMnKVxuICAgICAgICAgICAgLnNldERlc2MoXG4gICAgICAgICAgICAgICAgJ1R1cm4gb2ZmIHRoaXMgb3B0aW9uIHRvIGNob29zZSBmaWxlIHRoYXQgc2hvdWxkIGJlIGNvdW50ZWQnLFxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlKSA9PlxuICAgICAgICAgICAgICAgIHRvZ2dsZS5zZXRWYWx1ZSh0aGlzLnNob3dPbmx5Tm90ZVZhbHVlKS5vbkNoYW5nZSgodmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaG93T25seU5vdGVWYWx1ZSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5yZWxvYWRUaXRsZSgpO1xuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXNwbGF5KCk7XG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICApO1xuICAgICAgICBpZiAoIXRoaXMuc2hvd09ubHlOb3RlVmFsdWUpIHtcbiAgICAgICAgICAgIG5ldyBTZXR0aW5nKHRoaXMuY29udGFpbmVyRWwpXG4gICAgICAgICAgICAgICAgLnNldE5hbWUoJ0ZpbHRlciBMaXN0JylcbiAgICAgICAgICAgICAgICAuc2V0RGVzYyhcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlRnJhZ21lbnQoKGRlc2NFbCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY0VsLmFwcGVuZFRleHQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0V4dGVuc2lvbiBsaXN0IHRvIGluY2x1ZGUvZXhjbHVkZSBmaWxlIGR1cmluZyBjb3VudGluZycsXG4gICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY0VsLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2JyJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY0VsLmFwcGVuZFRleHQoJ1NlcGFyYXRlZCBieSBjb21tYScpO1xuICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgLmFkZFRleHRBcmVhKCh0ZXh0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG9uQ2hhbmdlID0gYXN5bmMgKHZhbHVlOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxpc3QgPSB2YWx1ZS5zcGxpdCgnLCcpLm1hcCgodikgPT4gdi50cmltKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZmlsdGVyTGlzdCA9IGxpc3Q7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5yZWxvYWRUaXRsZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIHRleHQuc2V0UGxhY2Vob2xkZXIoXG4gICAgICAgICAgICAgICAgICAgICAgICAnTGVhdmUgaXQgZW1wdHkgdG8gY291bnQgYWxsIHR5cGVzIG9mIGZpbGVzJyxcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgdGV4dC5zZXRWYWx1ZShcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmZpbHRlckxpc3Quam9pbignLCAnKSxcbiAgICAgICAgICAgICAgICAgICAgKS5vbkNoYW5nZShkZWJvdW5jZShvbkNoYW5nZSwgNTAwLCB0cnVlKSk7XG4gICAgICAgICAgICAgICAgICAgIHRleHQuaW5wdXRFbC5yb3dzID0gMjtcbiAgICAgICAgICAgICAgICAgICAgdGV4dC5pbnB1dEVsLmNvbHMgPSAyNTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIG5ldyBTZXR0aW5nKHRoaXMuY29udGFpbmVyRWwpXG4gICAgICAgICAgICAgICAgLnNldE5hbWUoJ0VuYWJsZSBCbGFja2xpc3QnKVxuICAgICAgICAgICAgICAgIC5zZXREZXNjKFxuICAgICAgICAgICAgICAgICAgICAnVHVybiBvbiB0aGlzIG9wdGlvbiB0byB1c2UgRmlsdGVyIExpc3QgdG8gZXhjbHVkZSBmaWxlcycsXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZSkgPT5cbiAgICAgICAgICAgICAgICAgICAgdG9nZ2xlXG4gICAgICAgICAgICAgICAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuYmxhY2tsaXN0KVxuICAgICAgICAgICAgICAgICAgICAgICAgLm9uQ2hhbmdlKCh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmJsYWNrbGlzdCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnJlbG9hZFRpdGxlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgfVxufVxuIiwiaW1wb3J0ICcuL3N0eWxlcy9wYXRjaC5jc3MnO1xuXG5pbXBvcnQge1xuICAgIHJvb3RIaWRkZW5DbGFzcyxcbiAgICBzaG93QWxsTnVtYmVyc0NsYXNzLFxuICAgIHdpdGhTdWJmb2xkZXJDbGFzcyxcbn0gZnJvbSAnbWlzYyc7XG5pbXBvcnQgeyBGaWxlRXhwbG9yZXIsIFBsdWdpbiwgVEZpbGUsIEFwcCB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IFdvcmtzcGFjZUxlYWYgfSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgeyBWYXVsdEhhbmRsZXIgfSBmcm9tICd2YXVsdC1oYW5kbGVyJztcbmltcG9ydCB7IEdyYXBoSW50ZXJhY3RvciB9IGZyb20gJ2dyYXBoLWludGVyYWN0b3InO1xuXG5pbXBvcnQgeyBzZXR1cFRpdGxlIH0gZnJvbSAnLi9mb2xkZXItdGl0bGUnO1xuaW1wb3J0IHsgREVGQVVMVF9TRVRUSU5HUywgRkVOb3RlQ291bnRTZXR0aW5nVGFiIH0gZnJvbSAnLi9zZXR0aW5ncyc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEZpbGVFeHBsb3Jlck5vdGVDb3VudCBleHRlbmRzIFBsdWdpbiB7XG4gICAgc2V0dGluZ3MgPSBERUZBVUxUX1NFVFRJTkdTO1xuXG4gICAgZmlsZUV4cGxvcmVyPzogRmlsZUV4cGxvcmVyO1xuXG4gICAgdmF1bHRIYW5kbGVyID0gbmV3IFZhdWx0SGFuZGxlcih0aGlzKTtcbiAgICBncmFwaEludGVyYWN0b3IgPSBuZXcgR3JhcGhJbnRlcmFjdG9yKHRoaXMpXG5cbiAgICAvKiogY29tcGF0aWJsZSB3aXRoIHRoZW1lIHRoYXQgaGlkZSByb290IGZvbGRlciAqL1xuICAgIGRvSGlkZGVuUm9vdCA9IChyZXZlcnQgPSBmYWxzZSkgPT4ge1xuICAgICAgICBpZiAoIXRoaXMuZmlsZUV4cGxvcmVyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdmaWxlLWV4cGxvcmVyIG5vdCBmb3VuZCcpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJvb3QgPSB0aGlzLmZpbGVFeHBsb3Jlci5maWxlSXRlbXNbJy8nXTtcbiAgICAgICAgY29uc3Qgc3R5bGVzID0gZ2V0Q29tcHV0ZWRTdHlsZShyb290LnRpdGxlSW5uZXJFbCk7XG4gICAgICAgIGNvbnN0IHNldHVwID0gKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc2hvdWxkSGlkZSA9XG4gICAgICAgICAgICBzdHlsZXMuZGlzcGxheSA9PT0gJ25vbmUnIHx8XG4gICAgICAgICAgICBzdHlsZXMuY29sb3IgPT09ICdyZ2JhKDAsIDAsIDAsIDApJztcbiAgICAgICAgICAgIHJvb3QudGl0bGVFbC50b2dnbGVDbGFzcyhyb290SGlkZGVuQ2xhc3MsICFyZXZlcnQgJiYgc2hvdWxkSGlkZSk7XG4gICAgICAgIH07XG4gICAgICAgIGlmIChzdHlsZXMuZGlzcGxheSAhPT0gJycpIHNldHVwKCk7XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbGV0IGNvdW50ID0gMDtcbiAgICAgICAgICAgIGNvbnN0IGRvSWQgPSB3aW5kb3cuc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChjb3VudCA+IDEwKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJyVvIHN0eWxlcyBlbXB0eScsIHJvb3QudGl0bGVJbm5lckVsKTtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwoZG9JZCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzdHlsZXMuZGlzcGxheSA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICAgICAgY291bnQrKztcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzZXR1cCgpO1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbChkb0lkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCAxMDApO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIGluaXRpYWxpemUgPSAocmV2ZXJ0ID0gZmFsc2UpID0+IHtcbiAgICAgICAgLy8gdGhpcy5ncmFwaEludGVyYWN0b3IudXBkYXRlR3JhcGhOb2RlcygpO1xuICAgXG5cbiAgICAgICAgY29uc3QgbGVhdmVzID0gdGhpcy5hcHAud29ya3NwYWNlLmdldExlYXZlc09mVHlwZSgnZmlsZS1leHBsb3JlcicpO1xuICAgICAgICBpZiAobGVhdmVzLmxlbmd0aCA+IDEpIGNvbnNvbGUuZXJyb3IoJ21vcmUgdGhlbiBvbmUgZmlsZS1leHBsb3JlcicpO1xuICAgICAgICBlbHNlIGlmIChsZWF2ZXMubGVuZ3RoIDwgMSkgY29uc29sZS5lcnJvcignZmlsZS1leHBsb3JlciBub3QgZm91bmQnKTtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuZmlsZUV4cGxvcmVyKVxuICAgICAgICAgICAgICAgIHRoaXMuZmlsZUV4cGxvcmVyID0gbGVhdmVzWzBdLnZpZXcgYXMgRmlsZUV4cGxvcmVyO1xuICAgICAgICAgICAgc2V0dXBUaXRsZSh0aGlzLCB0aGlzLnZhdWx0SGFuZGxlci52YXVsdCwgcmV2ZXJ0KTtcblxuICAgICAgICAgICAgLy8gdGhpcy5kb0hpZGRlblJvb3QocmV2ZXJ0KTtcbiAgICAgICAgICAgIGlmICghcmV2ZXJ0KSB7XG4gICAgICAgICAgICAgICAgLy8gdGhpcy5yZWdpc3RlckV2ZW50KFxuICAgICAgICAgICAgICAgIC8vICAgICB0aGlzLmFwcC53b3Jrc3BhY2Uub24oJ2Nzcy1jaGFuZ2UnLCB0aGlzLmRvSGlkZGVuUm9vdCksXG4gICAgICAgICAgICAgICAgLy8gKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFwcC53b3Jrc3BhY2Uub24oJ2xheW91dC1jaGFuZ2UnLCAoKSA9PiBzZXRUaW1lb3V0KCgpID0+IHRoaXMuZ3JhcGhJbnRlcmFjdG9yLnVwZGF0ZUdyYXBoTm9kZXMoKSwgMSkpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy52YXVsdEhhbmRsZXIucmVnaXN0ZXJWYXVsdEV2ZW50KCk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3Muc2hvd0FsbE51bWJlcnMpXG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYWRkQ2xhc3MoJ296LXNob3ctYWxsLW51bScpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFwcC53b3Jrc3BhY2UucmVtb3ZlRXZlbnRMaXN0ZW5lcignbGF5b3V0LWNoYW5nZScsIHRoaXMpXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBlbCBvZiBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFxuICAgICAgICAgICAgICAgICAgICB3aXRoU3ViZm9sZGVyQ2xhc3MsXG4gICAgICAgICAgICAgICAgICAgICkpIHtcbiAgICAgICAgICAgICAgICAgICAgZWwucmVtb3ZlQ2xhc3Mod2l0aFN1YmZvbGRlckNsYXNzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2xhc3Moc2hvd0FsbE51bWJlcnNDbGFzcyk7XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG5hc3luYyBvbmxvYWQoKSB7XG4gICAgY29uc29sZS5sb2coJ2xvYWRpbmcgRmlsZUV4cGxvcmVyTm90ZVRpdGxlJyk7XG4gICAgdGhpcy5hcHAud29ya3NwYWNlLm9uTGF5b3V0UmVhZHkodGhpcy5pbml0aWFsaXplKTtcbn1cblxub251bmxvYWQoKSB7XG4gICAgY29uc29sZS5sb2coJ3VubG9hZGluZyBGaWxlRXhwbG9yZXJOb3RlVGl0bGUnKTtcbiAgICB0aGlzLmluaXRpYWxpemUodHJ1ZSk7XG59XG5cblxucmVsb2FkVGl0bGUoKSB7XG4gICAgc2V0dXBUaXRsZSh0aGlzLCB0aGlzLnZhdWx0SGFuZGxlci52YXVsdCk7XG59XG5cbn1cbiJdLCJuYW1lcyI6WyJURm9sZGVyIiwiZGVib3VuY2UiLCJUQWJzdHJhY3RGaWxlIiwiUGx1Z2luIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBdURBO0FBQ08sU0FBUyxTQUFTLENBQUMsT0FBTyxFQUFFLFVBQVUsRUFBRSxDQUFDLEVBQUUsU0FBUyxFQUFFO0FBQzdELElBQUksU0FBUyxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUs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
